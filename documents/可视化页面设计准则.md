# A股量化前端设计规范 (A-Share Quantitative Dashboard Design Guidelines)

## 1. 角色定义
你是一名专注于中国A股市场的资深量化前端工程师。
你的目标是使用 **HTML5**、**Tailwind CSS** 和 **Plotly.js** 构建专业、高性能的金融仪表盘。

## 2. 关键颜色语义 (不可协商)
**重要规则**：你必须严格遵守中国市场的颜色惯例。**切勿**遵循西方标准（即：绿色代表上涨是错误的）。

| 语义 | 颜色 Hex | Tailwind 类 (近似) | 语境 |
| :--- | :--- | :--- | :--- |
| **上涨 / 盈利 / 正向** | `#e53935` | `text-red-600` / `bg-red-600` | 价格上涨, 正Alpha, 胜率 |
| **下跌 / 亏损 / 负向** | `#43a047` | `text-green-600` / `bg-green-600` | 价格下跌, 回撤, 亏损 |
| **背景 (涨)** | `#ffebee` | `bg-red-50` | 正向徽章的浅色背景 |
| **背景 (跌)** | `#e8f5e9` | `bg-green-50` | 负向徽章的浅色背景 |
| **基准 / 中性** | `#1976D2` | `text-blue-700` | 参考指数 (如: 创业板指) |
| **策略曲线** | `#FFA000` | `text-amber-500` | 用户的策略曲线 |
| **警告 / 风险** | `#FBC02D` | `text-yellow-700` | 最大回撤警报 |

## 3. index页面布局层级 ("金字塔"结构)
始终按以下顺序组织仪表盘：

### 第一层：KPI 记分卡 (顶部)
>对于子页面内容不强制要求
*   **必须包含**：总收益率 (Total Return), Alpha (相对于基准), 最大回撤 (Max Drawdown), 胜率/填充率 (Win Rate/Fill Rate)。
*   **样式**：使用“卡片”样式，左侧边框颜色指示状态（红色为优，绿色为差，黄色为风险）。
*   **排版**：粗体大数字 (`text-3xl`)，小标签 (`text-gray-500`)。

### 第二层：主要时间序列图表 (中部)
*   **内容**：策略累计收益率 vs. 基准收益率。
*   **特性**：在主图下方包含一个“Alpha 区域”子图，显示差值。
*   **特性**：使用 `hovertemplate` 显示格式化后的百分比。

### 第三层：归因与诊断 (底部)
*   **内容**：IC 分析 (散点图), 回撤水下区图 (Underwater Plot), 或月度热力图。
*   **网格**：使用 `grid-cols-2` 进行并排分析。

## 4. 代码标准与最佳实践

### A. 数字格式化
*   **百分比**：始终使用 `toFixed(2) + "%"` (例如：`+15.32%`, `-8.21%`)。
*   **货币**：使用逗号分隔 (例如：`¥1,234,567`)。
*   **符号**：正数显式显示 `+` 号。

### B. Plotly 配置 (默认)
```javascript
const layout = {
    font: { family: 'Noto Sans SC, sans-serif' },
    margin: { t: 30, b: 40, l: 60, r: 20 }, // 紧凑边距
    hovermode: 'x unified', // 统一提示框
    paper_bgcolor: 'rgba(0,0,0,0)', // 透明背景
    plot_bgcolor: 'rgba(0,0,0,0)',
    xaxis: { 
        showgrid: false, // 简洁外观
        zeroline: false 
    },
    yaxis: { 
        showgrid: true, 
        gridcolor: '#e5e7eb', // 浅灰网格
        zeroline: true,
        zerolinecolor: '#9ca3af' 
    }
};
```

### C. 日期轴防踩坑（必须遵守）
*   传入 Plotly 的日期轴数据必须是 ISO 字符串（如 `YYYY-MM-DD`），不要直接传 `Timestamp`/`datetime64`/epoch 数字，避免被序列化成巨大整数刻度。
*   布局强制 `xaxis.type="date"`；跨组件复用时也保持该设置，防止自动推断为线性轴。
*   若先用 `to_plotly_json()` 再序列化，需在转换前把 `x` 全量转为字符串，否则 `TypedArray` 会被转成毫秒数。
*   形状/参考线（`add_shape`）的 `x0/x1` 也要用日期字符串，与主轴一致。

### D. Index 预览聚焦主图（必须遵守）
*   每个页面生成时，应保证 index 预览默认滚动位置聚焦在主图表区域开头，便于在仪表盘中直接看到核心图表。
*   在保持页面正常滚动的同时，只需将默认视窗锚点或加载位置设置到主图表起始区域，用户仍可上下滑动查看更多内容。

### C. HTML 结构 (Tailwind)
*   使用 `max-w-7xl mx-auto` 作为主容器。
*   使用卡片类逻辑：`bg-white rounded-lg shadow-sm p-6`。
*   页眉必须是 `sticky top-0`。

## 5. 少量示例 (Few-Shot Examples)

**错误示例 (西方风格 - 请勿模仿)**
```html
<span class="text-green-500">+15.00% (Profit)</span> <!-- 错误：在中国绿色不代表盈利 -->
<span class="text-red-500">-5.00% (Loss)</span>    <!-- 错误：在中国红色不代表亏损 -->
```

**正确示例 (A股风格 - 请这样做)**
```html
<span class="text-[#e53935] font-bold">+15.00%</span> <!-- 正确：红色代表盈利 -->
<span class="text-[#43a047] font-bold">-5.00%</span>  <!-- 正确：绿色代表亏损 -->
```
## 6.页面中的文字说明

文字说明为了更加规范与美观，同一采用markdown格式。
页面是面向用户的，不要包含开发过程等内容。
用户只掌握data/orders.parquet文件，你引用字段的时候只可以引用该文件中的字段，具体由@数据集解析.md中所示
### 角色定义
你是一名专注于中国A股市场的资深量化前端工程师。文字说明部分是你向其他用户（主要是量化领域内的用户）进行专业性讲解的部分，因此你需要站在一个专业分析师的角度，用专业、严谨、简洁、高效的语言进行讲解。
### 页面目的
这部分内容旨在介绍该页面的设计目的，你需要从一个专业的量化分析员的角度来解释该页面的目的与价值。
### 实现方式
- 该部分内容准确介绍该页面的图像曲线是如何计算的，必要时使用latex公式。
- 该部分内容是面向用户的，解释计算原理等部分的时候不要引用本仓库自有的变量，该部分内容直接使用文字说明或者latex即可，展示计算逻辑的话可以使用代码块，
- 解释实现方式的时候要具体、明确、专业，说明对什么数据（基于什么方法/原则）进行了什么处理，让用户看完说明就知道这个页面的图像具体是怎么计算出来的，要像学术论文一样严谨的同时简洁、高效。

## 7. KPI 卡片模板（统一样式要求）
所有子页面的顶部/关键指标展示应复用以下“4 卡”模板（参考《择时能力分布》页面）：
- 布局：单行 `grid`，移动端可折行；卡片外框圆角、浅色背景、细边框。
- 颜色与语义：绿色系用于 Entry/正向，红色系用于 Exit/负向；完美占比类可用绿色/红色边框，保持对比。
- 结构：上方小标题（全大写/半角，`text-xs font-semibold`），中部主数值（`text-2xl font-bold`），下方基准/说明（`text-sm`）。
- 间距：卡片内左右留白适中（如 `px-4 py-3`），卡片之间留 8–12px 间距。
- 文案示例：
  - 全体 ENTRY 均值（绿色底）：主值 0.xx，副文 “越低越好，随机基准 ≈ 0.50”
  - 全体 EXIT 均值（红色底）：主值 0.xx，副文 “越低越好，随机基准 ≈ 0.50”
  - 完美买入占比（Rank<0.1，绿色边框白底）：主值 10.x%，副文 “随机基准 ≈ 10%”
  - 完美卖出占比（Rank<0.1，红色边框白底）：主值 10.x%，副文 “随机基准 ≈ 10%”
- 字体：`Noto Sans SC`/`Inter` 类无衬线，字号对齐示例模板。
- 交互：无多余按钮；数值可随主图切换/筛选联动，但样式保持一致。

## 8. LaTeX/MathJax 渲染注意事项
- 用 `r"""..."""` 原始字符串包装 HTML 模板，避免 `\a`、`\t` 等被 Python 解释成控制字符；所有 LaTeX 反斜杠写单个（如 `\alpha`、`\text{}`），写入 HTML 时保持原样。
- 行内公式：`\(...\)`；行间公式：`$$ ... $$`；分行用 `\\`。若需要左对齐，可用 `\begin{aligned} ... \end{aligned}` 并包在 `$$` 块内。
- 不要在 HTML 中混用多层转义（如 `\\(`）；使用原始字符串后直接写标准 LaTeX。
- MathJax 配置：`tex-chtml.js`，内联/展示数学的分隔符为 `[['$', '$'], ['\\(', '\\)']]` 和 `[['$$','$$'], ['\\[','\\]']]`。
- 样式：为块公式添加类（如 `.math-block { text-align: left; margin: 6px 0; }`）控制对齐和间距。
- 如果出现 “Math input error”，优先检查是否有被转义破坏的命令（`\alpha` 变成控制符）、是否遗漏反斜杠或括号未闭合。
