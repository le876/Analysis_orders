# 可视化输出——授信与保证金规则采集清单

目的：收集真实授信/保证金/清算口径，用于校准“最低所需本金（资金占用峰值）”与“资金占用收益率”并与“权益口径收益率（NAV）”对齐，最终估算更准确的初始本金与资金需求。

## 提交方式
- 建议以 YAML/JSON 配置（推荐 YAML），或直接在此文档下按清单逐项填写。
- 提交后我们将按参数回放 `data/orders.parquet`，并生成相应图表与 CSV/JSON 工件。

## 需要提供的规则与参数

### 1) 融资融券与保证金
- 空头保证金比例（如 50%、60%）；是否分市场/分证券分层（主板/创业板/科创板/ETF）。
- 多头融资保证金比例、可融资标的范围、可融资比例上限。
- 维持担保比例/预警线/平仓线（用于判断是否触发强平/补保证金）。
- 证券折算率（Haircut）：作为抵押物的证券折价系数，是否分级。
- 券源可借性：
  - 可借券清单与可借数量上限（如有）；
  - 借券失败时的回退规则（禁止开空/改买入/跳过）。

### 2) 资金可用口径（现金流规则）
- 卖出所得现金可用性：T+1 还是 T+0 即可再次买入？
- 开空卖出所得是否计入“可用现金”（多数情况下不计入，只产生保证金占用）。
- 平多卖出是否立即回补可用现金（常见为 T+0 可回补，用于后续买入）。
- 费用计入口径：佣金、经手费、印花税、过户费、借券费/融资利息，逐笔实时扣减还是日终统一计提？

### 3) 清算与结算时间轴
- 清算交割节奏（如 A 股 T+1 交割；是否存在融券 T+0 轧差豁免）。
- 日内资金轧差规则与粒度：逐笔/分钟/盘后批处理；买→卖、卖→买的可用资金更新时点。

### 4) 杠杆与集中度限制
- 总杠杆上限（例如 总资产/净资产 ≤ L）。
- 单证券/行业/板块的持仓或净敞口上限（占净资产比例）。
- 成交与流动性限制：单日成交占 ADV 上限、单笔下单比例、同向连续下单限制（如有）。

### 5) 成本参数
- 佣金费率与最小收费；是否双边/单边计费、是否含规费。
- 借券费率（年化/日化）、融资利率（年化/日化），计息方式与起息时间。
- 机会成本：是否将保证金占用的机会成本计入“资金占用收益率”。

### 6) 交易撮合与滑点假设
- 成交价口径：逐笔成交价/收盘价/VWAP/盘口价等；若与实盘不同，请说明。
- 成交量约束：是否受盘口量/可成交量/冰山委托等约束。
- 滑点模型：时间滑点、价格滑点参数（若另有统一配置，也请给出链接）。

### 7) 例外与熔断规则
- 停牌、涨跌停、临停时的下单/撤单处理规则。
- 非可融券标的的空头下单处理（禁止/回退/替代）。

### 8) 口径对齐与回放细节
- 权益口径：期初“权益本金”的确定方式（如：取盯市文件首日 NAV；或“首日现金占用峰值×安全系数（默认 1.3）”）。
- 资金占用口径（逐笔回放）：
  - 卖出平多是否 T+0 回补现金；
  - 卖出开空是否不计入可用现金、仅增加保证金占用；
  - 费用扣减在逐笔还是日终；
  - 以上是否与实盘一致。

## 本仓库默认/已实现的保守假设（如与实盘不符请指出差异）
- 空头保证金按 50% 计提；
- 卖出“开空”不计入可用现金，仅产生保证金占用；
- 卖出“平多”按成交额（扣费）立即回补可用现金（T+0 用于买入）；
- 逐笔统计 `required_equity = max(0, -cash_free) + short_margin`，取当日峰值作为“最低所需本金”；
- 相关实现见 `lightweight_analysis.py:7947–8010`。

## 输出与对接
- 基于以上参数，我们将提供：
  - 全周期“最低所需本金（现金+保证金）”日度序列；
  - “资金占用收益率”曲线（PnL/资金占用），与“权益口径收益率”并排展示；
  - 参数快照（CSV/JSON）作为实验工件，便于复现。

## YAML 示例配置
```yaml
credit_rules:
  # 保证金与授信
  margin_short_ratio: 0.50              # 空头保证金比例
  margin_long_ratio: 0.50               # 多头融资保证金比例（如适用）
  maintain_margin_ratio: 1.30           # 维持担保比例（示例）
  allow_short_proceeds_to_cash: false   # 开空所得是否计入可用现金
  allow_sell_long_cash_T0: true         # 平多卖出所得是否 T+0 可用
  settlement: T+1                       # 清算交割节奏
  haircut_table:                        # 折算率（示例）
    default: 0.10
    STAR: 0.30
    ChiNext: 0.20
  borrowable_list:                      # 可借券白名单（可选）
    - 600000.SH
    - 000001.SZ

  # 杠杆与集中度
  leverage_limit: 2.0
  concentration_limits:
    per_symbol: 0.10
    per_industry: 0.30

  # 成本参数（年化）
  commission_bps: 1.0                   # 佣金基点（示例）
  borrow_fee_rate_annual: 0.08          # 借券费率
  financing_rate_annual: 0.06           # 融资利率
  fee_accrual: realtime                 # 费用计提方式：realtime/end_of_day

  # 撮合与滑点（如适用）
  exec_price: trade                     # trade/close/vwap/quote
  slippage_bps: 2.0
```

---

> 请将你的实际参数替换示例中的占位符并回传。收到后我将校准回放逻辑，给出更贴近实盘的“初始本金/最低所需本金/资金占用收益率”等结果。
credit_rules:
  # 1) 融资融券与保证金
  margin_short_ratio: 0.50                 # 融券卖出保证金比例，不低于50%[61]
  margin_long_ratio: 1.00                  # 融资买入保证金比例，不低于100%[61]
  maintain_margin_ratio:
    alert: 1.40                            # 预警线（警戒线），低于需关注并补充[63]
    margin_call: 1.30                      # 追加保证金线（平仓线），低于触发追加担保[63]
    force_liquidation: 1.25                # 特殊品种平仓线[63]
  allow_short_proceeds_to_cash: false      # 开空所得不计入可用现金[61]
  allow_sell_long_cash_T0: true            # 平多卖出T+0回补可用现金
  settlement: T+1                          # A股T+1交割
  haircut_table:                           # 折算率上限[61]
    SZ50: 0.70
    non_SZ50: 0.65
    ETF: 0.90
    MMF_GOV: 0.95
    other_fund_bond: 0.80
    risk_warning: 0.00

  # 1) 券源可借性
  borrowable_list:                         # 标的池由交易所公布，此处示例
    - "深证100成份股"
    - "ETF"
  borrow_limits:                           # 个股融券余量上限触发25%流通量暂停[61]
    per_symbol_max_pct: 0.25
    ETF_max_pct: 0.75
  borrow_fail_rule: "reject"               # 借券失败则禁止开空

  # 2) 资金可用口径
  cash_settlement:
    short_proceeds: false                  # 开空所得不加入可用现金
    sell_long_rebate: true                 # 平多卖出T+0回补
    proceeds_available_at: "immediate"     # 平多即刻可用
  fee_entry:
    include_commission: true
    include_taxes: true
    include_financing_interest: true
    include_borrow_fee: true
    accrual: "realtime"                    # 实时计提

  # 3) 清算与结算时间轴
  settlement_cycle: T+1
  netting:
    intra_day: false
    post_market_batch: true

  # 4) 杠杆与集中度限制
  leverage_limit: 2.0                      # 按监管与券商一般限额
  concentration_limits:
    per_symbol: 0.25                       # 单只标的担保物市值/流通市值25%暂停[61]
    per_industry: null

  # 5) 成本参数
  commission_bps: 3.0                      # 佣金约0.03%
  borrow_fee_rate_annual: 0.12             # 融券借券费率（10–15%区间）
  financing_rate_annual: 0.08              # 融资利率（约8%）[44]
  opportunity_cost: true                   # 计入保证金占用机会成本

  # 6) 交易撮合与滑点假设
  exec_price: "trade"                      # 逐笔成交价
  slippage_bps: 0.0

  # 7) 例外与熔断规则
  stop_trade_on_halt: true
  limit_up_down_handling: "reject"         # 涨跌停禁止下单
  non_borrowable_short: "reject"

  # 8) 口径对齐与回放细节
  equity_definition: "first_day_NAV"       # 期初权益取首日NAV
  cash_replay_rules:
    sell_long: "T0_rebate"
    sell_short: "no_cash_credit"
    fee_deduction: "realtime"

