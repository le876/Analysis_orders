### 数据集解析（orders.parquet）

**目的**：为模型/分析脚本提供 orders.parquet 的精确口径，便于二次加工与可视化。所有口径均基于该文件字段，不引用外部数据。

---

#### 文件与规模
- 位置：`data/orders.parquet`
- 行列：8,469,308 行 × 13 列
- 内存占用：约 2.50 GB
- 覆盖交易日：242 天（2024-01-02 ～ 2024-12-31）
- 典型交易时段：09:30:00～14:56:59（极少数撮合到 23:59:59）

#### 字段字典（dtypes）
| 字段 | dtype | 含义/口径 |
| --- | --- | --- |
| Timestamp | datetime64[ms] | 记录时间，用于日/分钟聚合与排序 |
| tradeTimestamp | datetime64[ms] | 实际成交时间（撮合完成时刻） |
| Code | object | 证券代码，格式 `000001.SZ`/`600000.SH` 等 |
| direction | object | `B`=买入，`S`=卖出 |
| price | float32 | 下单价格，视为成交价近似 |
| orderQty | uint32 | 委托数量（股） |
| tradeQty | uint32 | 实际成交数量（股） |
| tradeAmount | float32 | 成交金额（≈price×tradeQty，人民币元） |
| fee | float32 | 手续费/规费（元） |
| real | float64 | 上游标签/真实值（收益类，含正负，非本文件计算） |
| orderTimestamp | object | 原始下单时间（字符串） |
| Type | object | 订单类型标签（H/Q 等） |
| pred | float64 | 模型预测分数（无量纲） |

缺失：`real` 有 53,060 个缺失；其他列无缺失。

#### 时间与标的覆盖
- Timestamp：2024-01-02 09:30:00 ～ 2024-12-31 14:56:58.510000  
- tradeTimestamp：2024-01-02 09:30:00.399000 ～ 2024-12-31 23:59:59.999000  
- 标的数：2,835 个 Code（深市主板/中小/创业板为主）

#### 方向与成交率
- direction 分布：B 3,986,857，S 4,482,451
- 填单率（tradeQty / orderQty）：  
  - 完全成交 (=1)：5,058,778 条（59.73%）  
  - 未成交 (=0)：3,030,388 条（35.78%）  
  - 部分成交 (0～1)：380,142 条（4.49%）  
  - 全样本均值 0.616，中位数 1.00

#### 资金口径统计
- 买入成交额合计：24,137,146,368 元  
- 卖出成交额合计：24,209,690,624 元  
- 手续费合计：21,553,404 元  
- 日成交额（按 Timestamp 的自然日）：中位数 199,182,528 元，均值 199,780,320 元；最高日 2024-10-08：276,953,824 元；最低日 2024-08-14：133,433,728 元。

#### 数值分布摘要
- 价格区间：0.12 ～ 488.89（元）
- 订单/成交量：orderQty 100～102,400 股；tradeQty 0～102,400 股
- tradeAmount：0～149,600 元
- fee：0～104.04 元
- pred 分位数：P1=-5.44，P5=-3.52，P50=-0.87，P95=3.45，P99=5.35
- real 分位数：P1=-13.39，P5=-7.35，P50=0.00，P95=7.81，P99=14.33

#### 数据质量要点
- 价格≤0：0 条；`tradeQty > orderQty`：0 条；全列重复：0 条。
- tradeAmount 与 price×tradeQty 在极值处可能有微小浮点偏差，不影响金额级别分析。

---

### 由 orders.parquet 直接衍生的缓存（便于复用）

#### 1) 完整交易配对 `data/paired_trades_fifo.parquet`
- 生成方式：按 Code 时间序列执行 FIFO，将买入/卖出逐笔配对，忽略未成交部分的 0 金额。
- 行数/列：4,956,827 行 × 16 列。
- 主要字段：`code`, `buy_timestamp`, `sell_timestamp`, `buy_amount`, `sell_amount`, `buy_fee`, `sell_fee`, `matched_qty`, `absolute_profit`, `buy_pred`, `buy_real`, `close_price`, `holding_minutes`, `trade_type`（多/空/对冲分类）。
- 典型用途：  
  - 盈利分布、持仓时长曲线：用 `absolute_profit`、`holding_minutes`。  
  - 信号评估：按 `buy_pred`/`buy_real` 分组或相关性分析。  
  - 成交额与费用：`buy_amount`/`sell_amount`、`buy_fee`/`sell_fee`。

##### 持仓时间口径（交易平均持仓时间页的数据来源）
- 计算方式：`holding_minutes = (sell_timestamp - buy_timestamp) / 60`，长/短方向保持正负号；若只需持有时长，取绝对值。
- 全量统计（绝对值）：中位数 9.61 分钟，P90≈1,206 分钟，P95≈1,444 分钟，均值≈296 分钟。
- 区间分布（绝对值占比）：  
  - ≤5 分钟：37.3%，5–10 分钟：13.5%，10–30 分钟：17.2%，30–60 分钟：6.8%，60–120 分钟：4.2%  
  - 120–240 分钟：6.1%，240–480 分钟：4.0%，480–1440 分钟：5.6%，1–2 天：2.5%，>2 天：2.9%
- 方向分布：`trade_type=long` 中位数≈9.23 分钟，`short` 方向（卖开买平）中位数≈10.01 分钟（带符号时为负）；做方向分析时注意符号含义，做持时分析建议用绝对值。

#### 2) 资金占用缓存 `data/capital_util_cache_*.parquet`
- 源于逐笔现金流回放（使用 orders.parquet 的 `tradeAmount`、`fee`、方向），保存每日资金占用、保证金等指标，供资金占用页面直接读取。

#### 3) 分钟/日级因子与快照缓存
- `minute_5m_cache.parquet`、`minute_5m_factors_cache.parquet`、`trade_factor_snapshots_cache.parquet`：用 orders 的 Code+时间窗去抓取并对齐5分钟行情与因子快照；适合做分钟级暴露、持仓时长分布等分析。与 orders 的连接键为 Code + 交易日/分钟。

（以上缓存均可从 orders.parquet 重新生成，无外部依赖即可理解口径。）

---

### 使用提示（面向后续 AI/脚本）
- 方向约定：现金流计算时，买入为现金流出（+fee），卖出为现金流入（-fee）；卖出数量不得超过持仓需在配对层面控制。
+- 汇率/货币：全部为人民币元，不含汇率换算。
+- 时间粒度选择：  
  - 持仓/时段分析用 `tradeTimestamp` 更贴近真实成交时点；  
  - 日度聚合、填单率、成交额分析用 `Timestamp` 即可。  
+- 过滤：若需只看成交记录，请筛选 `tradeQty > 0`；预测评估需同步剔除 `real` 缺失。
+- 典型衍生指标：  
  - 成交率 = `tradeQty / orderQty`  
  - 单笔净收益（配对后）= `sell_amount - buy_amount - buy_fee - sell_fee`  
  - 费用率 = `fee / tradeAmount`（方向无关，按绝对额）

该文档仅描述 orders.parquet 及其直接衍生缓存的字段、规模、分布与口径，便于任何下游 AI/脚本无歧义地读取和复用。***
